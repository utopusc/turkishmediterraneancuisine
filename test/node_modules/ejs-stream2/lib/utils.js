"use strict";
/*!
 * Copyright 2019 acrazing <joking.young@gmail.com>. All rights reserved.
 * @since 2019-10-12 14:18:46
 */
Object.defineProperty(exports, "__esModule", { value: true });
const tslib_1 = require("tslib");
const stream_1 = require("stream");
function sleep(timeout) {
    return new Promise((resolve) => setTimeout(resolve, timeout));
}
exports.sleep = sleep;
/** @internal */
function createReadable(readCount = 3, prefix = 'readable-') {
    const readable = new stream_1.Readable({
        read() {
            return tslib_1.__awaiter(this, void 0, void 0, function* () {
                yield sleep(1);
                if (readCount === 0) {
                    readable.push(null);
                }
                else {
                    readable.push(prefix + readCount);
                    readCount -= 1;
                }
            });
        },
    });
    return readable;
}
exports.createReadable = createReadable;
/** @internal */
function resolveReadable(readable) {
    const chunks = [];
    return new Promise((resolve, reject) => {
        readable.setEncoding('utf8');
        readable.on('data', (chunk) => chunks.push(chunk));
        readable.on('error', reject);
        readable.on('end', () => resolve(chunks));
    });
}
exports.resolveReadable = resolveReadable;
//# sourceMappingURL=utils.js.map