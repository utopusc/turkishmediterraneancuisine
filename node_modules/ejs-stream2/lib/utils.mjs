/*!
 * Copyright 2019 acrazing <joking.young@gmail.com>. All rights reserved.
 * @since 2019-10-12 14:18:46
 */
import { __awaiter, __generator } from "tslib";
import { Readable } from 'stream';
export function sleep(timeout) {
    return new Promise(function (resolve) { return setTimeout(resolve, timeout); });
}
/** @internal */
export function createReadable(readCount, prefix) {
    if (readCount === void 0) { readCount = 3; }
    if (prefix === void 0) { prefix = 'readable-'; }
    var readable = new Readable({
        read: function () {
            return __awaiter(this, void 0, void 0, function () {
                return __generator(this, function (_a) {
                    switch (_a.label) {
                        case 0: return [4 /*yield*/, sleep(1)];
                        case 1:
                            _a.sent();
                            if (readCount === 0) {
                                readable.push(null);
                            }
                            else {
                                readable.push(prefix + readCount);
                                readCount -= 1;
                            }
                            return [2 /*return*/];
                    }
                });
            });
        },
    });
    return readable;
}
/** @internal */
export function resolveReadable(readable) {
    var chunks = [];
    return new Promise(function (resolve, reject) {
        readable.setEncoding('utf8');
        readable.on('data', function (chunk) { return chunks.push(chunk); });
        readable.on('error', reject);
        readable.on('end', function () { return resolve(chunks); });
    });
}
//# sourceMappingURL=utils.js.map